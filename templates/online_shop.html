{% extends 'inherit.html' %}
{% load static %}

{% block head %}
    <meta name="{{ name }}" content="{{ description }}">
    <title>{{ title }}</title>
{% endblock %}


{% block body %}
    {% include 'inc/navbar.html'%}

{#  wrapping div  #}
    <div>

        {#  filter div  #}
        <div></div>

        {#   queryset div     #}
        <div class="container my-3 row m-0 justify-content-between">
        {% for items in list %}
            <div class="border my-2 col-lg-3 p-0" style="width: 25%">
                {% for item in items.product_img.all %}
                    {% ifequal forloop.counter 1 %}
                        <img src="{{ item.get_photo_url }}" height="200px" id="cover_img{{ items.pk }}" class="w-100 img" alt="{{ item.color }}">
                            <p id="text{{ items.pk }}" class="px-1 m-0" >Color: {{ item.color }}</p>

                    {% endifequal %}
                            <img src="{{ item.get_photo_url }}" id="small_img{{ items.pk }}" height="30px" width="30px" style="cursor:pointer;" onclick="change_img(event,{{ items.pk }})" class="m-2 img" alt="{{ item.color }}">
                {% endfor %}

                <div class="p-2">
                    <h4><a href="{% url 'detail-online-shop' items.pk %}" class="default_a">{{ items.name }}</a></h4>
                    <p style="color: red" class="m-0">Â£ {{ items.price }}</p>
                    <a onclick="add_to_cart(event,{{ items.pk }})" class="btn btn-dark ">+ ADD TO CART</a>
                    <a href="{% url 'wishlist-add' items.pk %}" class="default_a"><i class="fas fa-heart"></i></a>

                </div>
            </div>
        {% endfor %}
        </div>

    </div>

    <div style="position: fixed;bottom: -10%;left: 45%;transition: all 0.7s ease-in-out" class="text-white" id="sign">
        <p class="bg-dark px-2 p-1 " style="border-radius: 6px">Added to cart!</p>
    </div>

    {% include 'inc/footer.html' %}
{% endblock %}

<script>
{% block script %}

    const imgs = document.getElementsByClassName('img')
    const p = document.getElementsByClassName('color')

    for (let i=0;i<imgs.length;i++) {


        if (imgs[0].src === imgs[i].src&&(i!==0)) {
            imgs[i].style.border = '1px solid black'

        }

    }

    function change_img(e,pk){
        const p = document.getElementById(`text${pk}`)
        const cover = document.getElementById(`cover_img${pk}`)

        cover.src = e.target.src
        for (let i=1;i<imgs.length;i++) {
            imgs[i].style.border = 'none'


    }
        e.target.style.border = '1px solid black'
        p.innerHTML = `Color: ${e.target.alt}`
    }


    function add_to_cart(e,pk){
        const sign = document.getElementById('sign')
        const img = document.getElementById(`cover_img${pk}`)
        const color = img.alt
        const base_url = location.origin
        fetch(`${base_url}/add-to-cart/${pk}/1/${color}/`)
        .then((res)=>{
            return res.json()
        })
        .then((result)=>{
            if (result.added === 'redirect'){
                location.replace(`${base_url}/login/`)
            }
            else {
                sign.style.bottom = 10 + '%'
                setTimeout(() => {
                    sign.style.bottom = -10 + '%'
                }, 1500)
                count()
            }
        })

    }

{% endblock %}
</script>